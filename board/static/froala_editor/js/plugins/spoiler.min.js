(function ($) {
	$.FroalaEditor.PLUGINS.spoiler = function (editor) {
		function apply (val) {
			if (editor.selection.text() !== '') {
				editor.html.insert($.FroalaEditor.START_MARKER + '<span class="spoiler">' + editor.selection.text() + '</span>' + $.FroalaEditor.END_MARKER);
			}
//			else {
//				editor.html.insert('<span class="spoiler">' + $.FroalaEditor.INVISIBLE_SPACE + $.FroalaEditor.MARKERS + '</span>');
//			}
		}

		return {
			apply: apply
		}
	}

	$.FroalaEditor.DefineIcon('spoiler', {NAME: 'exclamation-triangle'});
	$.FroalaEditor.RegisterCommand('spoiler', {
		title: 'Spoiler',
		focus: true,
		undo: true,
		refreshOnCallback: false,
		callback: function (cmd, val) {
			this.spoiler.apply(val);
		},
		plugin: 'spoiler'
	});
})(jQuery);
